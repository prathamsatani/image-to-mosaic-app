name: Deploy to HF Spaces

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        pip install --upgrade huggingface_hub
    
    - name: Deploy to HF Spaces
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        python - <<EOF
        import os
        from huggingface_hub import HfApi
        
        api = HfApi(token=os.environ['HF_TOKEN'])
        
        # Use upload_large_folder for better handling
        api.upload_large_folder(
            folder_path=".",
            repo_id="titanite09/image-to-mosaic-app",
            repo_type="space",
            ignore_patterns=[".github/*", ".git/*", "__pycache__/*", "*.pyc"],
            multi_commits=True,
            multi_commits_verbose=True
        )
        print("Successfully deployed to Hugging Face Spaces!")
        EOF